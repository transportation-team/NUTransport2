
var myObj = new Object();
myObj.stop = ["Library / Norris", "Fisk Hall", "Weber Arch", "Jacobs Center", "Tech Institute", "Patten Gym", "Henry Crown Sports Pavilion", "Sheridan / Lincoln", "Sheridan / Noyes", "Sheridan / Foster", "Chicago / Sheridan", "Chicago / Grove", "Orrington / Clark"];
myObj["Library / Norris"] = {"times_north": ["0:00","0:30","1:00","1:30","2:00","2:30","3:00","9:00","9:30","10:00","10:30","11:00","11:30","12:00","12:30","13:00","13:30","14:00","14:30","15:00","15:30","16:00","16:30","17:00","17:30","18:00","18:30","19:00","19:30","20:00","20:30","21:00","21:30","22:00","22:30","23:00","23:30"], "times_south": ["0:20","0:50","1:20","1:50","2:20","2:50","3:20","9:20","9:50","10:20","10:50","11:20","11:50","12:20","12:50","13:20","13:50","14:20","14:50","15:20","15:50","16:20","16:50","17:20","17:50","18:20","18:50","19:20","19:50","20:20","20:50","21:20","21:50","22:20","22:50","23:20","23:50"] };
myObj["Fisk Hall"] = {"times_north": ["0:02","0:32","1:02","1:32","2:02","2:32","3:02","9:02","9:32","10:02","10:32","11:02","11:32","12:02","12:32","13:02","13:32","14:02","14:32","15:02","15:32","16:02","16:32","17:02","17:32","18:02","18:32","19:02","19:32","20:02","20:32","21:02","21:32","22:02","22:32","23:02","23:32"], "times_south": ["0:18","0:48","1:18","1:48","2:18","2:48","3:18","9:18","9:48","10:18","10:48","11:18","11:48","12:18","12:48","13:18","13:48","14:18","14:48","15:18","15:48","16:18","16:48","17:18","17:48","18:18","18:48","19:18","19:48","20:18","20:48","21:18","21:48","22:18","22:48","23:18","23:48"] };
myObj["Weber Arch"] = {"times_north": ["0:04","0:34","1:04","1:34","2:04","2:34","3:04","9:04","9:34","10:04","10:34","11:04","11:34","12:04","12:34","13:04","13:34","14:04","14:34","15:04","15:34","16:04","16:34","17:04","17:34","18:04","18:34","19:04","19:34","20:04","20:34","21:04","21:34","22:04","22:34","23:04","23:34"], "times_south": ["0:16","0:46","1:16","1:46","2:16","2:46","3:16","9:16","9:46","10:16","10:46","11:16","11:46","12:16","12:46","13:16","13:46","14:16","14:46","15:16","15:46","16:16","16:46","17:16","17:46","18:16","18:46","19:16","19:46","20:16","20:46","21:16","21:46","22:16","22:46","23:16","23:46"] };
myObj["Jacobs Center"] = {"times_north": ["0:05","0:35","1:05","1:35","2:05","2:35","3:05","9:05","9:35","10:05","10:35","11:05","11:35","12:05","12:35","13:05","13:35","14:05","14:35","15:05","15:35","16:05","16:35","17:05","17:35","18:05","18:35","19:05","19:35","20:05","20:35","21:05","21:35","22:05","22:35","23:05","23:35"], "times_south": ["0:15","0:45","1:15","1:45","2:15","2:45","3:15","9:15","9:45","10:15","10:45","11:15","11:45","12:15","12:45","13:15","13:45","14:15","14:45","15:15","15:45","16:15","16:45","17:15","17:45","18:15","18:45","19:15","19:45","20:15","20:45","21:15","21:45","22:15","22:45","23:15","23:45"] };
myObj["Tech Institute"] = {"times_north": ["0:06","0:36","1:06","1:36","2:06","2:36","3:06","9:06","9:36","10:06","10:36","11:06","11:36","12:06","12:36","13:06","13:36","14:06","14:36","15:06","15:36","16:06","16:36","17:06","17:36","18:06","18:36","19:06","19:36","20:06","20:36","21:06","21:36","22:06","22:36","23:06","23:36"], "times_south": ["0:13","0:43","1:13","1:43","2:13","2:43","3:13","9:13","9:43","10:13","10:43","11:13","11:43","12:13","12:43","13:13","13:43","14:13","14:43","15:13","15:43","16:13","16:43","17:13","17:43","18:13","18:43","19:13","19:43","20:13","20:43","21:13","21:43","22:13","22:43","23:13","23:43"] };
myObj["Patten Gym"] = {"times_north": ["0:07","0:37","1:07","1:37","2:07","2:37","3:07","9:07","9:37","10:07","10:37","11:07","11:37","12:07","12:37","13:07","13:37","14:07","14:37","15:07","15:37","16:07","16:37","17:07","17:37","18:07","18:37","19:07","19:37","20:07","20:37","21:07","21:37","22:07","22:37","23:07","23:37"], "times_south": ["0:12","0:42","1:12","1:42","2:12","2:42","3:12","9:12","9:42","10:12","10:42","11:12","11:42","12:12","12:42","13:12","13:42","14:12","14:42","15:12","15:42","16:12","16:42","17:12","17:42","18:12","18:42","19:12","19:42","20:12","20:42","21:12","21:42","22:12","22:42","23:12","23:42"] };
myObj["Henry Crown Sports Pavilion"] = {"times_north": ["0:09","0:39","1:09","1:39","2:09","2:39","3:09","9:09","9:39","10:09","10:39","11:09","11:39","12:09","12:39","13:09","13:39","14:09","14:39","15:09","15:39","16:09","16:39","17:09","17:39","18:09","18:39","19:09","19:39","20:09","20:39","21:09","21:39","22:09","22:39","23:09","23:39"], "times_south": ["0:09","0:39","1:09","1:39","2:09","2:39","3:09","9:09","9:39","10:09","10:39","11:09","11:39","12:09","12:39","13:09","13:39","14:09","14:39","15:09","15:39","16:09","16:39","17:09","17:39","18:09","18:39","19:09","19:39","20:09","20:39","21:09","21:39","22:09","22:39","23:09","23:39"] };
myObj["Sheridan / Lincoln"] = {"times_north": ["0:12","0:42","1:12","1:42","2:12","2:42","3:12","9:12","9:42","10:12","10:42","11:12","11:42","12:12","12:42","13:12","13:42","14:12","14:42","15:12","15:42","16:12","16:42","17:12","17:42","18:12","18:42","19:12","19:42","20:12","20:42","21:12","21:42","22:12","22:42","23:12","23:42"], "times_south": ["0:07","0:37","1:07","1:37","2:07","2:37","3:07","9:07","9:37","10:07","10:37","11:07","11:37","12:07","12:37","13:07","13:37","14:07","14:37","15:07","15:37","16:07","16:37","17:07","17:37","18:07","18:37","19:07","19:37","20:07","20:37","21:07","21:37","22:07","22:37","23:07","23:37"] };
myObj["Sheridan / Noyes"] = {"times_north": ["0:13","0:43","1:13","1:43","2:13","2:43","3:13","9:13","9:43","10:13","10:43","11:13","11:43","12:13","12:43","13:13","13:43","14:13","14:43","15:13","15:43","16:13","16:43","17:13","17:43","18:13","18:43","19:13","19:43","20:13","20:43","21:13","21:43","22:13","22:43","23:13","23:43"], "times_south": ["0:06","0:36","1:06","1:36","2:06","2:36","3:06","9:06","9:36","10:06","10:36","11:06","11:36","12:06","12:36","13:06","13:36","14:06","14:36","15:06","15:36","16:06","16:36","17:06","17:36","18:06","18:36","19:06","19:36","20:06","20:36","21:06","21:36","22:06","22:36","23:06","23:36"] };
myObj["Sheridan / Foster"] = {"times_north": ["0:15","0:45","1:15","1:45","2:15","2:45","3:15","9:15","9:45","10:15","10:45","11:15","11:45","12:15","12:45","13:15","13:45","14:15","14:45","15:15","15:45","16:15","16:45","17:15","17:45","18:15","18:45","19:15","19:45","20:15","20:45","21:15","21:45","22:15","22:45","23:15","23:45"], "times_south": ["0:05","0:35","1:05","1:35","2:05","2:35","3:05","9:05","9:35","10:05","10:35","11:05","11:35","12:05","12:35","13:05","13:35","14:05","14:35","15:05","15:35","16:05","16:35","17:05","17:35","18:05","18:35","19:05","19:35","20:05","20:35","21:05","21:35","22:05","22:35","23:05","23:35"] };
myObj["Chicago / Sheridan"] = {"times_north": ["0:16","0:46","1:16","1:46","2:16","2:46","3:16","9:16","9:46","10:16","10:46","11:16","11:46","12:16","12:46","13:16","13:46","14:16","14:46","15:16","15:46","16:16","16:46","17:16","17:46","18:16","18:46","19:16","19:46","20:16","20:46","21:16","21:46","22:16","22:46","23:16","23:46"], "times_south": ["0:04","0:34","1:04","1:34","2:04","2:34","3:04","9:04","9:34","10:04","10:34","11:04","11:34","12:04","12:34","13:04","13:34","14:04","14:34","15:04","15:34","16:04","16:34","17:04","17:34","18:04","18:34","19:04","19:34","20:04","20:34","21:04","21:34","22:04","22:34","23:04","23:34"] };
myObj["Chicago / Grove"] = {"times_north": ["0:18","0:48","1:18","1:48","2:18","2:48","3:18","9:18","9:48","10:18","10:48","11:18","11:48","12:18","12:48","13:18","13:48","14:18","14:48","15:18","15:48","16:18","16:48","17:18","17:48","18:18","18:48","19:18","19:48","20:18","20:48","21:18","21:48","22:18","22:48","23:18","23:48"], "times_south": ["0:02","0:32","1:02","1:32","2:02","2:32","3:02","9:02","9:32","10:02","10:32","11:02","11:32","12:02","12:32","13:02","13:32","14:02","14:32","15:02","15:32","16:02","16:32","17:02","17:32","18:02","18:32","19:02","19:32","20:02","20:32","21:02","21:32","22:02","22:32","23:02","23:32"] };
myObj["Orrington / Clark"] = {"times_north": ["0:20","0:50","1:20","1:50","2:20","2:50","3:20","9:20","9:50","10:20","10:50","11:20","11:50","12:20","12:50","13:20","13:50","14:20","14:50","15:20","15:50","16:20","16:50","17:20","17:50","18:20","18:50","19:20","19:50","20:20","20:50","21:20","21:50","22:20","22:50","23:20","23:50"], "times_south": ["0:00","0:30","1:00","1:30","2:00","2:30","3:00","9:00","9:30","10:00","10:30","11:00","11:30","12:00","12:30","13:00","13:30","14:00","14:30","15:00","15:30","16:00","16:30","17:00","17:30","18:00","18:30","19:00","19:30","20:00","20:30","21:00","21:30","22:00","22:30","23:00","23:30"] };
myObj.numTimes = 6;
var NUMSTOPS = 9;

var x = 0;
var y = 0;
function generate_table() {
    // get the reference for the body
    var body = document.getElementsByClassName("table-box")[0];
    //time input, so can make red if wrong
    var timeform = document.getElementsByClassName("time")[0];
    // creates a <table> element and a <tbody> element
    var tbl = document.createElement("table");
    var tblBody = document.createElement("tbody");

    //Suppose we wanted to arrive at Central by 3:00 pm, from Linden
    var start = document.getElementById("start").value;
    var destination = document.getElementById("destination").value;
    var time = document.getElementById("time12").value;
    if (time.toString()=="")
    {
        y = 1;
        timeform.style.border = "2px solid red";
        var errorMessage = document.createElement("p");
        errorMessage.id = "error-text"
        errorMessage.innerHTML = "Invalid Time Input";
        errorMessage.style.color = "red";
        errorMessage.style.fontSize = ".7em";
        errorMessage.style.marginBottom = "-10px";
        var diverr = document.getElementById("error-message");
        diverr.appendChild(errorMessage);
    }
    else
    {
        timeform.style.border = null;
        if (y==1)
        {
            var errorMessage = document.getElementById("error-text");
            errorMessage.parentNode.removeChild(errorMessage);
            y = 0;
        }
        var times;
        startIndex = myObj.stop.indexOf(start);
        endIndex = myObj.stop.indexOf(destination);
        if (startIndex > endIndex)
        {
            times = "times_north"
        }
        else
        {
            times = "times_south"
        }

        time = time.split(":");
        var timeConverted = parseInt(time[0]) * 60 + parseInt(time[1]);

        var i = 0;
        var continueLoop = true;
        var today = new Date();
        var currTime = today.getHours() + ":" + today.getMinutes();

        //finds first time after when input time is
        while (continueLoop == true) {
            currTime = myObj[start][times][i];
            currTime = currTime.split(":")
            var currTimeConverted = parseInt(currTime[0]) * 60 + parseInt(currTime[1]);
            if (currTimeConverted < timeConverted) {
                i = i + 1;
            }
            else {
                continueLoop = false;
            }
            if (i == myObj.numTimes) {
                continueLoop = false;
            }
        }


        //Now i-1 is the correct entry
        var lastTrip = i;
        var numColumns = 5;
        if (numColumns + lastTrip > myObj.numTimes) 
        {
            numColumns = myObj.numTimes - lastTrip;
        }
        //    var firstTrip = max(0, lastTrip-5);
        if (numColumns == 0)
        {
            y = 1;
            var errorMessage = document.createElement("p");
            errorMessage.id = "error-text"
            errorMessage.innerHTML = "No Trips After This Time";
            errorMessage.style.color = "red";
            errorMessage.style.fontSize = ".7em";
            errorMessage.style.marginBottom = "-10px";
            var diverr = document.getElementById("error-message");
            diverr.appendChild(errorMessage);
        }
        else
        {
            if (y==1)
            {
                var errorMessage = document.getElementById("error-text");
                errorMessage.parentNode.removeChild(errorMessage);
                y = 0;
            }
            var currStop;
            // creating all cells
            var row = document.createElement("tr");
            var cell = document.createElement("th");
            var cellText = document.createTextNode("Upcoming Trips");
            cell.appendChild(cellText);
            row.appendChild(cell);

            if (startIndex <= endIndex) {
                for (var k = lastTrip; k < lastTrip + numColumns; k++) {
                    var cell = document.createElement("th");
                    var text = k + 1 - lastTrip;
                    var cellText = document.createTextNode("Departure " + text);
                    cell.appendChild(cellText);
                    row.appendChild(cell);
                }
                tblBody.appendChild(row);
                for (var j = startIndex; j <= endIndex; j++){
                    // creates a table row
                    var row = document.createElement("tr");
                    
                    var cell = document.createElement("th");
                    currStop = myObj.stop[j];
                    var cellText = document.createTextNode(currStop);
                    cell.appendChild(cellText);
                    row.appendChild(cell);
                
                    for (var i = lastTrip; i < lastTrip + numColumns; i++)  {
                        // Create a <td> element and a text node, make the text
                        // node the contents of the <td>, and put the <td> at
                        // the end of the table row
                        var cell = document.createElement("td");
                        currStop = myObj.stop[j];
                        var cellTime = new Date("August 19, 1975 " + myObj[currStop][times][i]);
                        cellTime = cellTime.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
                        var cellText = document.createTextNode(cellTime);
                        cell.appendChild(cellText);
                        row.appendChild(cell);
                    }
                
                    // add the row to the end of the table body
                    tblBody.appendChild(row);
                }
            }
            else {
                for (var k = lastTrip; k < lastTrip + numColumns; k++) {
                    var cell = document.createElement("th");
                    var text = k + 1 - lastTrip;
                    var cellText = document.createTextNode("Departure " + text);
                    cell.appendChild(cellText);
                    row.appendChild(cell);
                }
                tblBody.appendChild(row);
                for (var j = startIndex; j >= endIndex; j--){
                    // creates a table row
                    var row = document.createElement("tr");
                    
                    var cell = document.createElement("th");
                    currStop = myObj.stop[j];
                    var cellText = document.createTextNode(currStop);
                    cell.appendChild(cellText);
                    row.appendChild(cell);
                
                    for (var i = lastTrip; i < lastTrip + numColumns; i++)  {
                        // Create a <td> element and a text node, make the text
                        // node the contents of the <td>, and put the <td> at
                        // the end of the table row
                        var cell = document.createElement("td");
                        currStop = myObj.stop[j];
                        var cellTime = new Date("August 19, 1975 " + myObj[currStop][times][i]);
                        cellTime = cellTime.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
                        var cellText = document.createTextNode(cellTime);
                        cell.appendChild(cellText);
                        row.appendChild(cell);
                    }
                
                    // add the row to the end of the table body
                    tblBody.appendChild(row);
                }
            }

            // put the <tbody> in the <table>
            tbl.appendChild(tblBody);
            tblBody.classList.add("table");
            tblBody.classList.add("table-box");
            tbl.setAttribute("id", "remove");
            tbl.setAttribute("border", "2");
            // appends <table> into <body>
            if(x==0)
            {
                body.appendChild(tbl);
                x = x +1;
            }
            else
            {
                var tblRemove = document.getElementById("remove");
                tblRemove.parentNode.removeChild(tblRemove);
                body.appendChild(tbl);
            }
            // sets the border attribute of tbl to 2;
        }
    }
   
}

function init() {

}